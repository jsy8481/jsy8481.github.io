---
title: "02. ë®¤í…Œì´ì…˜ (Mutations)"
description: "ë®¤í…Œì´ì…˜(Mutation)ì€ ì„œë²„ì˜ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ì‘ì—…ì…ë‹ˆë‹¤. ë°ì´í„° ìƒì„±, ìˆ˜ì •, ì‚­ì œì™€ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤."
date: "2026-02-16"
---

## ë®¤í…Œì´ì…˜ì´ë€?

### ê°œë… ì •ì˜

**ë®¤í…Œì´ì…˜(Mutation)** ì€ ì„œë²„ì˜ ë°ì´í„°ë¥¼ **ë³€ê²½** í•˜ëŠ” ì‘ì—…ì…ë‹ˆë‹¤. ì¿¼ë¦¬(Query)ê°€ ë°ì´í„°ë¥¼ "ì½ê¸°"ë§Œ í•œë‹¤ë©´, ë®¤í…Œì´ì…˜ì€ ë°ì´í„°ë¥¼ "ìƒì„±, ìˆ˜ì •, ì‚­ì œ"í•©ë‹ˆë‹¤.

> ğŸ’¡ **ë¹„ìœ **: ì€í–‰ ì—…ë¬´ì—ì„œ ì”ì•¡ ì¡°íšŒëŠ” Query, ì…ê¸ˆ/ì¶œê¸ˆ/ì´ì²´ëŠ” Mutationì…ë‹ˆë‹¤.

| êµ¬ë¶„ | HTTP ë©”ì„œë“œ | ì˜ˆì‹œ |
|------|------------|------|
| Query (ì½ê¸°) | GET | ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ, ìƒì„¸ ì •ë³´ ì¡°íšŒ |
| Mutation (ë³€ê²½) | POST, PUT, PATCH, DELETE | ì‚¬ìš©ì ìƒì„±, ì •ë³´ ìˆ˜ì •, ì‚­ì œ |

### ì™œ ë®¤í…Œì´ì…˜ì„ ë”°ë¡œ ì²˜ë¦¬í•˜ë‚˜ìš”?

ì½ê¸°ì™€ ì“°ê¸°ëŠ” ê·¼ë³¸ì ìœ¼ë¡œ ë‹¤ë¥¸ íŠ¹ì„±ì„ ê°€ì§‘ë‹ˆë‹¤:

| íŠ¹ì„± | Query | Mutation |
|------|-------|----------|
| **ìºì‹±** | ìºì‹± í•„ìˆ˜ | ìºì‹± ë¶ˆí•„ìš” (ì¼íšŒì„±) |
| **ì¬ì‹œë„** | ì•ˆì „í•˜ê²Œ ì¬ì‹œë„ ê°€ëŠ¥ | ì£¼ì˜ í•„ìš” (ì¤‘ë³µ ìƒì„± ìœ„í—˜) |
| **ìƒíƒœ** | loading, error, data | pending, error, success |
| **ë¶€ìˆ˜ íš¨ê³¼** | ì—†ìŒ | ìˆìŒ (ë°ì´í„° ë³€ê²½) |

---

## useMutation ê¸°ë³¸ ì‚¬ìš©ë²•

### ê¸°ë³¸ êµ¬ì¡°

```tsx
import { useMutation, useQueryClient } from '@tanstack/react-query';

function CreateUserForm() {
  // 1. QueryClient ì ‘ê·¼ (ìºì‹œ ì¡°ì‘ìš©)
  const queryClient = useQueryClient();

  // 2. Mutation ì •ì˜
  const mutation = useMutation({
    // ì‹¤ì œ API í˜¸ì¶œ í•¨ìˆ˜
    mutationFn: (newUser: CreateUserInput) =>
      fetch('/api/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newUser),
      }).then(r => r.json()),
    
    // ì„±ê³µ ì‹œ ì½œë°±
    onSuccess: (data, variables, context) => {
      console.log('ìƒì„±ëœ ì‚¬ìš©ì:', data);
      // ì‚¬ìš©ì ëª©ë¡ ìºì‹œ ë¬´íš¨í™” â†’ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì¡°íšŒ
      queryClient.invalidateQueries({ queryKey: ['users'] });
    },
    
    // ì‹¤íŒ¨ ì‹œ ì½œë°±
    onError: (error, variables, context) => {
      console.error('ìƒì„± ì‹¤íŒ¨:', error);
      alert('ì‚¬ìš©ì ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    },
  });

  // 3. í¼ ì œì¶œ í•¸ë“¤ëŸ¬
  const handleSubmit = (e: FormEvent) => {
    e.preventDefault();
    
    // mutate() í˜¸ì¶œë¡œ ë®¤í…Œì´ì…˜ ì‹¤í–‰
    mutation.mutate({
      name: 'Kim',
      email: 'kim@example.com',
    });
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* í¼ í•„ë“œë“¤ */}
      <button 
        type="submit" 
        disabled={mutation.isPending}
      >
        {mutation.isPending ? 'ì²˜ë¦¬ ì¤‘...' : 'ìƒì„±'}
      </button>
    </form>
  );
}
```

**ì½”ë“œ ìƒì„¸ ì„¤ëª…:**

- `useQueryClient()`: QueryClient ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•©ë‹ˆë‹¤. ìºì‹œ ë¬´íš¨í™”, ìˆ˜ë™ ì—…ë°ì´íŠ¸ ë“±ì— ì‚¬ìš©í•©ë‹ˆë‹¤.

- `mutationFn`: ì‹¤ì œ ì„œë²„ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. Promiseë¥¼ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
  - `newUser`: `mutate()`ì— ì „ë‹¬ëœ ë°ì´í„°ê°€ ì—¬ê¸°ë¡œ ë“¤ì–´ì˜µë‹ˆë‹¤.

- `onSuccess(data, variables, context)`: ë®¤í…Œì´ì…˜ ì„±ê³µ ì‹œ ì‹¤í–‰ë©ë‹ˆë‹¤.
  - `data`: ì„œë²„ì—ì„œ ë°˜í™˜ëœ ì‘ë‹µ ë°ì´í„°
  - `variables`: `mutate()`ì— ì „ë‹¬í•œ ì›ë³¸ ë°ì´í„°
  - `context`: `onMutate`ì—ì„œ ë°˜í™˜í•œ ì»¨í…ìŠ¤íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì— ì‚¬ìš©)

- `invalidateQueries()`: ì§€ì •í•œ ì¿¼ë¦¬ë¥¼ "stale(ì˜¤ë˜ë¨)" ìƒíƒœë¡œ ë§ˆí‚¹í•©ë‹ˆë‹¤. í•´ë‹¹ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ìˆë‹¤ë©´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì¡°íšŒí•©ë‹ˆë‹¤.

- `mutation.mutate()`: ë®¤í…Œì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ë¹„ë™ê¸°ì´ì§€ë§Œ Promiseë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

- `mutation.isPending`: ë®¤í…Œì´ì…˜ì´ ì§„í–‰ ì¤‘ì¸ì§€ ì—¬ë¶€. ì¤‘ë³µ ì œì¶œ ë°©ì§€ì— ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (Optimistic Update)

### ê°œë…

**ë‚™ê´€ì  ì—…ë°ì´íŠ¸** ëŠ” ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  **UIë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸** í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ì‚¬ìš©ì ê²½í—˜ì„ í¬ê²Œ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

> ğŸ’¡ **ë¹„ìœ **: ì¹´ì¹´ì˜¤í†¡ì—ì„œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ì¦‰ì‹œ ì±„íŒ…ì°½ì— ë‚˜íƒ€ë‚˜ê³ , ì „ì†¡ ì‹¤íŒ¨ ì‹œ "ì¬ì „ì†¡" í‘œì‹œê°€ ëœ¨ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

### ì™œ í•„ìš”í•œê°€?

```
ì¼ë°˜ì ì¸ íë¦„:
1. ì‚¬ìš©ìê°€ "ì¢‹ì•„ìš”" í´ë¦­
2. ì„œë²„ì— ìš”ì²­ ì „ì†¡ (500ms ì†Œìš”)
3. ì‘ë‹µ ìˆ˜ì‹ 
4. UI ì—…ë°ì´íŠ¸ â† ì‚¬ìš©ìëŠ” ì´ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•¨

ë‚™ê´€ì  ì—…ë°ì´íŠ¸:
1. ì‚¬ìš©ìê°€ "ì¢‹ì•„ìš”" í´ë¦­
2. UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸ â† ì‚¬ìš©ìëŠ” ì¦‰ê°ì ì¸ í”¼ë“œë°± ë°›ìŒ
3. ì„œë²„ì— ìš”ì²­ ì „ì†¡
4. (ì„±ê³µ) ìœ ì§€ / (ì‹¤íŒ¨) ë¡¤ë°±
```

### êµ¬í˜„ ì½”ë“œ

```tsx
const mutation = useMutation({
  mutationFn: updateUser,
  
  // ========== 1ë‹¨ê³„: ë®¤í…Œì´ì…˜ ì‹œì‘ ì „ ==========
  onMutate: async (newData) => {
    // ì§„í–‰ ì¤‘ì¸ ì¿¼ë¦¬ ì·¨ì†Œ (ë°ì´í„° ì¶©ëŒ ë°©ì§€)
    // ì™œ? ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì¤‘ì´ë©´ ìš°ë¦¬ê°€ ì„¤ì •í•œ ë‚™ê´€ì  ê°’ì„ ë®ì–´ì“¸ ìˆ˜ ìˆìŒ
    await queryClient.cancelQueries({ 
      queryKey: ['users', newData.id] 
    });
    
    // í˜„ì¬ ìºì‹œ ë°ì´í„° ë°±ì—… (ë¡¤ë°±ìš©)
    const previousUser = queryClient.getQueryData(['users', newData.id]);
    
    // ìºì‹œë¥¼ ë‚™ê´€ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ (ì„œë²„ ì‘ë‹µ ì „ì— UI ë°˜ì˜)
    queryClient.setQueryData(['users', newData.id], newData);
    
    // ë¡¤ë°±ì— ì‚¬ìš©í•  ì»¨í…ìŠ¤íŠ¸ ë°˜í™˜
    return { previousUser };
  },
  
  // ========== 2ë‹¨ê³„: ì—ëŸ¬ ë°œìƒ ì‹œ ==========
  onError: (err, newData, context) => {
    // ì—ëŸ¬ ë°œìƒ! ë°±ì—…í•´ë‘” ì´ì „ ë°ì´í„°ë¡œ ë³µêµ¬
    if (context?.previousUser) {
      queryClient.setQueryData(
        ['users', newData.id], 
        context.previousUser
      );
    }
    // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ì•Œë¦¼
    toast.error('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
  },
  
  // ========== 3ë‹¨ê³„: ì„±ê³µ/ì‹¤íŒ¨ ê´€ê³„ì—†ì´ ==========
  onSettled: () => {
    // ì„œë²„ ë°ì´í„°ì™€ ë™ê¸°í™”ë¥¼ ìœ„í•´ ì¿¼ë¦¬ ì¬ê²€ì¦
    // ì™œ? ë‚™ê´€ì ìœ¼ë¡œ ë„£ì€ ë°ì´í„°ê°€ ì„œë²„ ì‘ë‹µê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
    queryClient.invalidateQueries({ queryKey: ['users'] });
  },
});
```

**íë¦„ ë‹¤ì´ì–´ê·¸ë¨:**

```
ì‚¬ìš©ì í´ë¦­
    â”‚
    â–¼
onMutate ì‹¤í–‰
â”œâ”€â”€ ì§„í–‰ ì¤‘ì¸ ì¿¼ë¦¬ ì·¨ì†Œ
â”œâ”€â”€ ì´ì „ ë°ì´í„° ë°±ì—…
â””â”€â”€ UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ë‚™ê´€ì )
    â”‚
    â–¼
ì„œë²„ ìš”ì²­ ì „ì†¡
    â”‚
    â”œâ”€â”€ ì„±ê³µ â”€â”€â–¶ onSuccess â”€â”€â–¶ onSettled (ì¬ê²€ì¦)
    â”‚
    â””â”€â”€ ì‹¤íŒ¨ â”€â”€â–¶ onError (ë¡¤ë°±) â”€â”€â–¶ onSettled (ì¬ê²€ì¦)
```

### ì‹¤ì „ ì˜ˆì œ: ì¢‹ì•„ìš” ê¸°ëŠ¥

```tsx
function LikeButton({ postId, initialLiked }: Props) {
  const queryClient = useQueryClient();
  
  const likeMutation = useMutation({
    mutationFn: () => toggleLike(postId),
    
    onMutate: async () => {
      await queryClient.cancelQueries({ queryKey: ['post', postId] });
      
      const previousPost = queryClient.getQueryData<Post>(['post', postId]);
      
      // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: ì¢‹ì•„ìš” í† ê¸€
      queryClient.setQueryData<Post>(['post', postId], (old) => ({
        ...old!,
        isLiked: !old!.isLiked,
        likeCount: old!.isLiked ? old!.likeCount - 1 : old!.likeCount + 1,
      }));
      
      return { previousPost };
    },
    
    onError: (err, _, context) => {
      queryClient.setQueryData(['post', postId], context?.previousPost);
    },
    
    onSettled: () => {
      queryClient.invalidateQueries({ queryKey: ['post', postId] });
    },
  });

  const { data: post } = useQuery({
    queryKey: ['post', postId],
    queryFn: () => getPost(postId),
  });

  return (
    <button 
      onClick={() => likeMutation.mutate()}
      disabled={likeMutation.isPending}
    >
      {post?.isLiked ? 'â¤ï¸' : 'ğŸ¤'} {post?.likeCount}
    </button>
  );
}
```

---

## Mutation ìƒíƒœ í™œìš©

### ìƒíƒœ ì¢…ë¥˜

```tsx
const mutation = useMutation({ ... });

// êµ¬ì¡° ë¶„í•´ í• ë‹¹ìœ¼ë¡œ ìƒíƒœ ì¶”ì¶œ
const { 
  isPending,   // ì§„í–‰ ì¤‘
  isError,     // ì—ëŸ¬ ë°œìƒ
  isSuccess,   // ì„±ê³µ ì™„ë£Œ
  isIdle,      // ì•„ì§ ì‹¤í–‰ ì•ˆ í•¨
  error,       // ì—ëŸ¬ ê°ì²´
  data,        // ì„±ê³µ ì‹œ ë°˜í™˜ ë°ì´í„°
  reset,       // ìƒíƒœ ì´ˆê¸°í™” í•¨ìˆ˜
} = mutation;
```

**ê° ìƒíƒœ ì„¤ëª…:**

| ìƒíƒœ | ì„¤ëª… | ì‚¬ìš© ì‚¬ë¡€ |
|------|------|----------|
| `isPending` | ìš”ì²­ì´ ì§„í–‰ ì¤‘ | ë¡œë”© ìŠ¤í”¼ë„ˆ, ë²„íŠ¼ ë¹„í™œì„±í™” |
| `isError` | ìš”ì²­ ì‹¤íŒ¨ | ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ |
| `isSuccess` | ìš”ì²­ ì„±ê³µ | ì„±ê³µ ë©”ì‹œì§€, ëª¨ë‹¬ ë‹«ê¸° |
| `isIdle` | ì•„ì§ ì‹¤í–‰ ì•ˆ í•¨ | ì´ˆê¸° ìƒíƒœ |
| `error` | Error ê°ì²´ | ì—ëŸ¬ ìƒì„¸ ì •ë³´ í‘œì‹œ |
| `data` | ì„±ê³µ ì‘ë‹µ ë°ì´í„° | ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ ID í™œìš© |
| `reset()` | ìƒíƒœë¥¼ idleë¡œ ì´ˆê¸°í™” | í¼ ì¬ì‚¬ìš©, ì—ëŸ¬ ì´ˆê¸°í™” |

### UI í”¼ë“œë°± ì˜ˆì œ

```tsx
function CreatePostForm() {
  const mutation = useMutation({ mutationFn: createPost });

  return (
    <form onSubmit={...}>
      <textarea name="content" disabled={mutation.isPending} />
      
      <button disabled={mutation.isPending}>
        {mutation.isPending ? (
          <>
            <Spinner /> ê²Œì‹œ ì¤‘...
          </>
        ) : (
          'ê²Œì‹œí•˜ê¸°'
        )}
      </button>
      
      {/* ì—ëŸ¬ í‘œì‹œ */}
      {mutation.isError && (
        <div className="error">
          <p>âŒ {mutation.error.message}</p>
          <button onClick={() => mutation.reset()}>ë‹«ê¸°</button>
        </div>
      )}
      
      {/* ì„±ê³µ í‘œì‹œ */}
      {mutation.isSuccess && (
        <div className="success">
          âœ… ê²Œì‹œ ì™„ë£Œ! 
          <Link href={`/posts/${mutation.data.id}`}>ë³´ëŸ¬ ê°€ê¸°</Link>
        </div>
      )}
    </form>
  );
}
```

---

## í™œìš© íŒ

### 1. mutateAsyncë¡œ Promise ë‹¤ë£¨ê¸°

```tsx
const mutation = useMutation({ mutationFn: createUser });

// mutate(): ì½œë°± ìŠ¤íƒ€ì¼
mutation.mutate(data, {
  onSuccess: (result) => console.log(result),
});

// mutateAsync(): Promise ë°˜í™˜ (async/await ì‚¬ìš© ê°€ëŠ¥)
const handleSubmit = async () => {
  try {
    const result = await mutation.mutateAsync(data);
    router.push(`/users/${result.id}`);
  } catch (error) {
    // ì—ëŸ¬ ì²˜ë¦¬
  }
};
```

### 2. ì—¬ëŸ¬ ì¿¼ë¦¬ í•œ ë²ˆì— ë¬´íš¨í™”

```tsx
onSuccess: () => {
  // ê´€ë ¨ëœ ëª¨ë“  ì¿¼ë¦¬ ë¬´íš¨í™”
  queryClient.invalidateQueries({ queryKey: ['users'] });     // ëª©ë¡
  queryClient.invalidateQueries({ queryKey: ['user', userId] }); // ìƒì„¸
  queryClient.invalidateQueries({ queryKey: ['posts'] });     // ê´€ë ¨ ë°ì´í„°
}
```

### 3. í¼ ë¦¬ì…‹ íƒ€ì´ë°

```tsx
onSuccess: () => {
  queryClient.invalidateQueries({ queryKey: ['users'] });
  form.reset();        // í¼ ì´ˆê¸°í™”
  setIsOpen(false);    // ëª¨ë‹¬ ë‹«ê¸°
  toast.success('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}
```

---

## ë ˆí¼ëŸ°ìŠ¤

- [TanStack Query - Mutations](https://tanstack.com/query/latest/docs/framework/react/guides/mutations)
- [TanStack Query - Optimistic Updates](https://tanstack.com/query/latest/docs/framework/react/guides/optimistic-updates)
- [TanStack Query - Mutation Side Effects](https://tanstack.com/query/latest/docs/framework/react/guides/mutations#mutation-side-effects)

**ë‹¤ìŒ ì¥**: [06. ìºì‹± ì „ëµ](./06-caching-strategies.md)
