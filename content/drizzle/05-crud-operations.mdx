---
title: "05. CRUD ì¡°ì‘ (CRUD Operations)"
description: "ê¸°ë³¸ì ì¸ ì¡°ì‘ì„ ë„˜ì–´, ì‹¤ë¬´ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë³µì¡í•œ ë°ì´í„° ì²˜ë¦¬ íŒ¨í„´ì„ ë‹¤ë£¹ë‹ˆë‹¤."
date: "2026-02-16"
---

ê¸°ë³¸ì ì¸ ì¡°ì‘ì„ ë„˜ì–´, ì‹¤ë¬´ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë³µì¡í•œ ë°ì´í„° ì²˜ë¦¬ íŒ¨í„´ì„ ë‹¤ë£¹ë‹ˆë‹¤.

---

## ğŸ” 1. í•„í„° & ì—°ì‚°ì ì´ì •ë¦¬ (Cheat Sheet)

`where` ì ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ì—°ì‚°ìë“¤ì…ë‹ˆë‹¤. `import { eq, gt, ... } from 'drizzle-orm'` í•´ì„œ ì”ë‹ˆë‹¤.

| ì—°ì‚°ì | SQL ëŒ€ì‘ | ì‚¬ìš© ì˜ˆì‹œ | ë¹„ê³  |
|--------|----------|-----------|------|
| `eq` | `=` | `eq(table.id, 1)` | Equal |
| `ne` | `<>` | `ne(table.status, 'deleted')` | Not Equal |
| `gt` / `gte` | `>` / `>=` | `gt(table.age, 18)` | Greater Than |
| `lt` / `lte` | `<` / `<=` | `lt(table.price, 1000)` | Less Than |
| `like` | `LIKE` | `like(table.name, '%Kim%')` | ë¶€ë¶„ ì¼ì¹˜ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ O) |
| `ilike` | `ILIKE` | `ilike(table.name, '%kim%')` | **[PGì „ìš©]** ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ë§¤ì¹­ |
| `inArray` | `IN` | `inArray(table.id, [1, 2, 3])` | ë°°ì—´ì— í¬í•¨ ì—¬ë¶€ |
| `notInArray`| `NOT IN` | `notInArray(table.role, ['admin'])` | |
| `isNull` | `IS NULL` | `isNull(table.deletedAt)` | |
| `isNotNull`| `IS NOT NULL`| `isNotNull(table.email)` | |
| `between` | `BETWEEN` | `between(table.age, 20, 30)` | |

### ë…¼ë¦¬ ì—°ì‚°ì ê²°í•©
```typescript
import { and, or, not } from 'drizzle-orm';

// (age >= 20 AND status = 'active') OR role = 'admin'
await db.select().from(users).where(
  or(
    and(gte(users.age, 20), eq(users.status, 'active')),
    eq(users.role, 'admin')
  )
);
```

---

## â• 2. Insert ì‹¬í™” (Upsert & Returning)

### Upsert (ìˆìœ¼ë©´ ìˆ˜ì •, ì—†ìœ¼ë©´ ì…ë ¥)
PostgreSQLì˜ `ON CONFLICT` êµ¬ë¬¸ì„ í™œìš©í•©ë‹ˆë‹¤.

```typescript
// IDê°€ ê²¹ì¹˜ë©´ ì´ë¦„ì„ ì—…ë°ì´íŠ¸í•˜ê³ , ì•„ë‹ˆë©´ ìƒˆë¡œ ë§Œë“¦
await db.insert(users).values({ id: 1, name: 'New Name' })
  .onConflictDoUpdate({
    target: users.id, // ì¶©ëŒ ê°ì§€í•  ì»¬ëŸ¼ (Unique/PK)
    set: { name: 'New Name', updatedAt: new Date() }, // ìˆ˜ì •í•  ë‚´ìš©
  });

// IDê°€ ê²¹ì¹˜ë©´ ê·¸ëƒ¥ ë¬´ì‹œ (ì•„ë¬´ê²ƒë„ ì•ˆ í•¨)
await db.insert(users).values({ id: 1, ... })
  .onConflictDoNothing();
```

### Returning (ê²°ê³¼ ë°”ë¡œ ë°›ê¸°)
Insert ë¿ë§Œ ì•„ë‹ˆë¼ Update, Deleteì—ì„œë„ ë©ë‹ˆë‹¤!

```typescript
// ì‚­ì œëœ ìœ ì € ì •ë³´ë¥¼ ë°˜í™˜ë°›ìŒ (ë¡œê·¸ ë‚¨ê¸¸ ë•Œ ìœ ìš©)
const [deletedUser] = await db.delete(users)
  .where(eq(users.id, 1))
  .returning({ 
    deletedId: users.id, 
    deletedEmail: users.email 
  });
```

---

## âœï¸ 3. Update ì‹¬í™” (Atomic Increments)

"ì¡°íšŒìˆ˜ +1" ê°™ì€ ê¸°ëŠ¥ ë§Œë“¤ ë•Œ, ê°’ì„ ì½ì–´ì™€ì„œ +1 í•˜ê³  ë‹¤ì‹œ ì €ì¥í•˜ë©´ ë™ì‹œì„± ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤. DBì—ì„œ ì§ì ‘ ì—°ì‚°í•˜ì„¸ìš”.

```typescript
import { sql } from 'drizzle-orm';

// ì¡°íšŒìˆ˜ = í˜„ì¬ ì¡°íšŒìˆ˜ + 1 (Atomic)
await db.update(posts)
  .set({ 
    views: sql`${posts.views} + 1`,
    updatedAt: new Date(),
  })
  .where(eq(posts.id, 5));
```

---

## ğŸš› 4. ëŒ€ëŸ‰ ì¡°ì‘ (Batch Operations)

ìˆ˜ë§Œ ê±´ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” ë„¤íŠ¸ì›Œí¬ ì™•ë³µ(Round Trip)ì„ ì¤„ì—¬ì•¼ í•©ë‹ˆë‹¤.

### Bulk Insert
```typescript
const manyUsers = Array(1000).fill({ ... });
await db.insert(users).values(manyUsers); 
// Drizzleì´ í•˜ë‚˜ì˜ SQLë¡œ ë¬¶ì–´ì„œ ë³´ëƒ…ë‹ˆë‹¤. (Limit ìˆìŒ, ë³´í†µ 65535 íŒŒë¼ë¯¸í„°)
```

### Transaction í™œìš©
ì—¬ëŸ¬ ì‘ì—…ì„ í•œ ë²ˆì— ë¬¶ìŠµë‹ˆë‹¤.

```typescript
await db.transaction(async (tx) => {
  // 1. ìœ ì € ìƒì„±
  const [user] = await tx.insert(users).values(...).returning();
  
  // 2. í”„ë¡œí•„ ìƒì„± (ìœ ì € ID í•„ìš”)
  await tx.insert(profiles).values({ userId: user.id, ... });
  
  // 3. í™˜ì˜ ì´ë©”ì¼ ë¡œê·¸
  await tx.insert(logs).values(...);
});
```

---

## ğŸ”— ë ˆí¼ëŸ°ìŠ¤
- [Operators](https://orm.drizzle.team/docs/operators)
- [Insert / Upsert](https://orm.drizzle.team/docs/insert)
- [Update](https://orm.drizzle.team/docs/update)

**ë‹¤ìŒ ì¥**: [06. ê³ ê¸‰ ì¿¼ë¦¬ (Advanced Queries)](./06-advanced-queries.md)
