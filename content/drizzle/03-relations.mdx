---
title: "03. ê´€ê³„ ì •ì˜ (Relations)"
description: "1:1, 1:N, N:M ë“± ì‹¤ë¬´ì—ì„œ ë§ˆì£¼ì¹  ìˆ˜ ìˆëŠ” ëª¨ë“  ê´€ê³„ íŒ¨í„´ì„ ì •ë¦¬í•œ ë ˆí¼ëŸ°ìŠ¤ì…ë‹ˆë‹¤."
date: "2026-02-16"
---

ì‹¤ë¬´ì—ì„œ ë§ˆì£¼ì¹  ìˆ˜ ìˆëŠ” ëª¨ë“  ê´€ê³„ íŒ¨í„´ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. **"ë³µì‚¬í•´ì„œ ì“°ê¸° ì¢‹ì€"** í˜•íƒœì˜ ë ˆí¼ëŸ°ìŠ¤ì…ë‹ˆë‹¤.

---

## ğŸ“ 1. ê´€ê³„ì˜ ë‘ ì¶•: References vs Relations

| êµ¬ë¶„ | References (`.references()`) | Relations (`relations()`) |
|------|------------------------------|---------------------------|
| **ì—­í• ** | **DB ì œì•½ì¡°ê±´ (Foreign Key)** | **ORM ì¡°íšŒ í¸ì˜ì„± (Navigation)** |
| **ìœ„ì¹˜** | `pgTable` ì•ˆì˜ ì»¬ëŸ¼ ì •ì˜ | `relations` í•¨ìˆ˜ ë‚´ë¶€ |
| **íš¨ê³¼** | ë¬´ê²°ì„± ë³´ì¥ (ì—†ëŠ” ID ì…ë ¥ ì°¨ë‹¨) | `with: { posts: true }` ì‚¬ìš© ê°€ëŠ¥ |
| **í•„ìˆ˜?** | **í•„ìˆ˜** (DB ì„¤ê³„ì˜ ê¸°ë³¸) | ì„ íƒ (ì¡°íšŒ í¸í•˜ê²Œ í•˜ë ¤ë©´ í•„ìˆ˜) |

> â­ï¸ **Rule**: `relations`ë¥¼ ì •ì˜í•˜ë ¤ë©´, ë¨¼ì € í…Œì´ë¸”ì— `Foreign Key`ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ§© 2. íŒ¨í„´ë³„ êµ¬í˜„ (Copy & Paste)

### 1ï¸âƒ£ 1:N (ì¼ëŒ€ë‹¤) - ê°€ì¥ ê¸°ë³¸
**ìƒí™©**: í•œ ìœ ì €(`User`)ê°€ ì—¬ëŸ¬ ê¸€(`Post`)ì„ ì‘ì„±.

```typescript
// schema/users.ts
export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: text('name'),
});

// schema/posts.ts
export const posts = pgTable('posts', {
  id: serial('id').primaryKey(),
  title: text('title'),
  // 1. Foreign Key ì„¤ì • (DB)
  authorId: integer('author_id').references(() => users.id), 
});

// relations.ts (í˜¹ì€ ê° íŒŒì¼ í•˜ë‹¨)
export const usersRelations = relations(users, ({ many }) => ({
  posts: many(posts), // ìœ ì €ëŠ” ê¸€ì„ 'ì—¬ëŸ¬ ê°œ' ê°€ì§
}));

export const postsRelations = relations(posts, ({ one }) => ({
  author: one(users, {
    fields: [posts.authorId], // ë‚´ í…Œì´ë¸” ì»¬ëŸ¼
    references: [users.id],   // ì°¸ì¡° í…Œì´ë¸” ì»¬ëŸ¼
  }),
}));
```

---
> ğŸ’¡ **Q. ì™œ í•œìª½ë§Œ `fields`, `references`ë¥¼ ê¸¸ê²Œ ì“°ë‚˜ìš”?**
>
> **A. ì™¸ë˜í‚¤(Foregin Key)ë¥¼ 'ì‹¤ì œë¡œ ê°€ì§„ ìª½'ì´ ê´€ê³„ì˜ ì£¼ì¸ì…ë‹ˆë‹¤.**
> - **Post (ìì‹/FK ë³´ìœ )**: `authorId`ë¼ëŠ” ì‹¤ì œ ì»¬ëŸ¼ì´ ìˆìœ¼ë¯€ë¡œ, **"ë‚´ `authorId` ì»¬ëŸ¼ì´ `User` í…Œì´ë¸”ì˜ `id` ì»¬ëŸ¼ì„ ê°€ë¦¬í‚µë‹ˆë‹¤"**ë¼ê³  ëª…í™•íˆ ì ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤. (`fields`, `references` í•„ìˆ˜)
> - **User (ë¶€ëª¨/ì°¸ì¡° ë‹¹í•¨)**: DBì— ì‹¤ì œ ì»¬ëŸ¼ì´ ì—†ìŠµë‹ˆë‹¤. ê·¸ëƒ¥ **"ë‚œ `Post`ë“¤ì„ ì—¬ëŸ¬ ê°œ ê°€ì§€ê³  ìˆì–´"**(`many(posts)`)ë¼ê³  ì„ ì–¸ë§Œ í•˜ë©´, Drizzleì´ ì•Œì•„ì„œ `Post` ìª½ì˜ ì •ì˜ë¥¼ ë³´ê³  ì—°ê²°í•´ì¤ë‹ˆë‹¤.

### 2ï¸âƒ£ 1:1 (ì¼ëŒ€ì¼) - í”„ë¡œí•„, ì„¤ì •
**ìƒí™©**: ìœ ì €(`User`)ëŠ” í•˜ë‚˜ì˜ í”„ë¡œí•„(`Profile`)ë§Œ ê°€ì§.

```typescript
// schema/profile.ts
export const profiles = pgTable('profiles', {
  id: serial('id').primaryKey(),
  bio: text('bio'),
  // Foreign Keyì— unique()ë¥¼ ë¶™ì´ë©´ 1:1ì´ ë¨! â­ï¸
  userId: integer('user_id').references(() => users.id).unique(),
});

// relations
export const usersRelations = relations(users, ({ one }) => ({
  profile: one(profiles), // ìœ ì €ëŠ” í”„ë¡œí•„ì„ 'í•˜ë‚˜' ê°€ì§
}));

export const profilesRelations = relations(profiles, ({ one }) => ({
  user: one(users, {
    fields: [profiles.userId],
    references: [users.id],
  }),
}));
```

> ğŸ’¡ **Pro Tip: ì–´ë””ì— `references`ë¥¼ ë„£ì–´ì•¼ í• ê¹Œìš”?**
>
> 1:1 ê´€ê³„ì—ì„œëŠ” **"ì¢…ì†ë˜ëŠ” ìª½(Dependent)"** ì´ Foreign Keyë¥¼ ê°€ì§‘ë‹ˆë‹¤.
> - **User vs Profile**: í”„ë¡œí•„ì€ ìœ ì € ì—†ì´ëŠ” ì¡´ì¬í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, `Profile` í…Œì´ë¸”ì— `user_id` ì»¬ëŸ¼ì„ ë§Œë“­ë‹ˆë‹¤.
> - **User vs Config**: ì„¤ì •ë„ ìœ ì €ì— ì¢…ì†ë˜ë¯€ë¡œ, `Config` í…Œì´ë¸”ì— `user_id`ë¥¼ ë§Œë“­ë‹ˆë‹¤.
>
> Drizzleì˜ `relations` ì •ì˜ ì‹œ:
> - **FKê°€ ìˆëŠ” ìª½(Profile)**: `fields: [profile.userId], references: [users.id]`ë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤.
> - **FKê°€ ì—†ëŠ” ìª½(User)**: ê·¸ëƒ¥ `profile: one(profiles)`ë¼ê³ ë§Œ ì ì–´ë„ Drizzleì´ ì•Œì•„ì„œ ì—°ê²°í•´ì¤ë‹ˆë‹¤.

---

### 3ï¸âƒ£ N:M (ë‹¤ëŒ€ë‹¤) - ì—°ê²° í…Œì´ë¸” í•„ìˆ˜ â­ï¸
**ìƒí™©**: ê¸€(`Post`)ì— íƒœê·¸(`Category`)ê°€ ì—¬ëŸ¬ ê°œ, íƒœê·¸ í•˜ë‚˜ì—ë„ ê¸€ì´ ì—¬ëŸ¬ ê°œ.

ì‹¤ë¬´ì—ì„  **ëª…ì‹œì  ì—°ê²° í…Œì´ë¸”(Explicit Junction Table)** ì„ ë§Œë“œëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤. ê·¸ë˜ì•¼ ì—°ê²° í…Œì´ë¸”ì— ì¶”ê°€ ì •ë³´(ì˜ˆ: `assignedAt`)ë¥¼ ë„£ì„ ìˆ˜ ìˆê±°ë“ ìš”.

```typescript
// 1. Post í…Œì´ë¸”
export const posts = pgTable('posts', { id: serial('id').primaryKey() });

// 2. Category í…Œì´ë¸”
export const categories = pgTable('categories', { id: serial('id').primaryKey() });

// 3. ì—°ê²° í…Œì´ë¸” (Junction Table)
export const postsToCategories = pgTable('posts_to_categories', {
  postId: integer('post_id').references(() => posts.id).notNull(),
  categoryId: integer('category_id').references(() => categories.id).notNull(),
}, (t) => ({
  pk: primaryKey({ columns: [t.postId, t.categoryId] }), // ë³µí•©í‚¤ ì¶”ì²œ
}));

// 4. Relations ì •ì˜
export const postsRelations = relations(posts, ({ many }) => ({
  postsToCategories: many(postsToCategories), // ì¼ë‹¨ ì—°ê²° í…Œì´ë¸”ì´ë‘ 1:N
}));

export const categoriesRelations = relations(categories, ({ many }) => ({
  postsToCategories: many(postsToCategories),
}));

export const postsToCategoriesRelations = relations(postsToCategories, ({ one }) => ({
  post: one(posts, { fields: [postsToCategories.postId], references: [posts.id] }),
  category: one(categories, { fields: [postsToCategories.categoryId], references: [categories.id] }),
}));
```

> ğŸ’¡ **Q. N:Mì¸ë° ì™œ ì—°ê²° í…Œì´ë¸”ì—ì„  `one`ì„ ì“°ë‚˜ìš”?**
>
> **A. ì—°ê²° í…Œì´ë¸”ì˜ 'í•œ í–‰(Row)' ê¸°ì¤€ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**
> - `posts_to_categories` í…Œì´ë¸”ì— ë“¤ì–´ê°€ëŠ” **ë°ì´í„° í•œ ì¤„** ì€, "ì´ ê¸€(1ê°œ)"ê³¼ "ì´ íƒœê·¸(1ê°œ)"ë¥¼ ì‡ëŠ” **ë‹¨ì¼ ì—°ê²°ê³ ë¦¬**ì…ë‹ˆë‹¤.
> - ì—°ê²°ê³ ë¦¬ í•˜ë‚˜ëŠ”, ì–‘ìª½ ëì— ê°ê° í•˜ë‚˜ì˜ `Post`ì™€ í•˜ë‚˜ì˜ `Category`ë¥¼ ì¡ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ `one`ì…ë‹ˆë‹¤.
> - ë°˜ëŒ€ë¡œ `Post` ì…ì¥ì—ì„œëŠ” ì´ëŸ° ì—°ê²°ê³ ë¦¬ê°€ ì—¬ëŸ¬ ê°œ ì£¼ë ì£¼ë  ë§¤ë‹¬ë¦´ ìˆ˜ ìˆìœ¼ë‹ˆ `many`ê°€ ë©ë‹ˆë‹¤.

> ğŸ’¡ **Q. ì•„í•˜, 'ëª‡ ê°œë¥¼ ì¥ê³  ìˆëƒ'ê°€ ê¸°ì¤€ì¸ê°€ìš”?**
>
> **A. ë§ìŠµë‹ˆë‹¤! "í˜„ì¬ ì •ì˜í•˜ê³  ìˆëŠ” í…Œì´ë¸”ì˜ ë°ì´í„° 1ì¤„"ì´ ì£¼ì¸ê³µì…ë‹ˆë‹¤.**
> - **ì—°ê²° í…Œì´ë¸”ì˜ 1ì¤„**: `postId` í•˜ë‚˜, `categoryId` í•˜ë‚˜ë¥¼ ì¥ê³  ìˆì£ ? -> ê·¸ë˜ì„œ ì–‘ìª½ ë‹¤ **`one`**
> - **Post í…Œì´ë¸”ì˜ 1ì¤„**: ë‚´ ê¸€ì— ë‹¬ë¦° ì—°ê²°ê³ ë¦¬(PostsToCategories)ëŠ” ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆì£ ? -> ê·¸ë˜ì„œ **`many`**
>
> **ìš”ì•½**: "ë‚˜(í˜„ì¬ í…Œì´ë¸”ì˜ Row)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìŸ¤(ëŒ€ìƒ)ê°€ ëª‡ ê°œì•¼?"ë¼ê³  ë¬¼ì–´ë³´ì„¸ìš”.
  
**ì¡°íšŒí•  ë•Œ:**
```typescript
const result = await db.query.posts.findMany({
  with: {
    postsToCategories: {
      with: {
        category: true, // í•œ ë‹¨ê³„ ê±°ì³ì„œ ê°€ì ¸ì˜´
      }
    }
  }
});
// result[0].postsToCategories[0].category.name ìœ¼ë¡œ ì ‘ê·¼
```

---

### 4ï¸âƒ£ Self-Referencing (ìê¸° ì°¸ì¡°) - ëŒ“ê¸€, íŒ”ë¡œìš°

**ìƒí™© 1: ëŒ€ëŒ“ê¸€ (ê³„ì¸µí˜• êµ¬ì¡°)**
ëŒ“ê¸€(`Comment`)ì´ ë¶€ëª¨ ëŒ“ê¸€(`parent_id`)ì„ ê°€ì§.

```typescript
export const comments = pgTable('comments', {
  id: serial('id').primaryKey(),
  content: text('content'),
  parentId: integer('parent_id'), // ìê¸° ìì‹ ì˜ idë¥¼ ì°¸ì¡°í•  ì˜ˆì •
});

export const commentsRelations = relations(comments, ({ one, many }) => ({
  // ë¶€ëª¨ ëŒ“ê¸€ (1ê°œ)
  parent: one(comments, {
    fields: [comments.parentId],
    references: [comments.id], 
    relationName: 'comment_parent', // â­ï¸ ì´ë¦„ í•„ìˆ˜ (êµ¬ë¶„ìš©)
  }),
  // ëŒ€ëŒ“ê¸€ë“¤ (ì—¬ëŸ¬ ê°œ)
  replies: many(comments, {
    relationName: 'comment_parent', // ê°™ì€ ì´ë¦„ìœ¼ë¡œ ë§¤ì¹­
  }),
}));
```

**ìƒí™© 2: ìœ ì € íŒ”ë¡œìš° (User -> User)**
N:M ìê¸° ì°¸ì¡°ì…ë‹ˆë‹¤. ë³„ë„ì˜ íŒ”ë¡œìš° í…Œì´ë¸”ì´ í•„ìš”í•©ë‹ˆë‹¤.

```typescript
export const follows = pgTable('follows', {
  followerId: integer('follower_id').references(() => users.id),
  followingId: integer('following_id').references(() => users.id),
}, (t) => ({
  pk: primaryKey({ columns: [t.followerId, t.followingId] }),
}));

export const usersRelations = relations(users, ({ many }) => ({
  // ë‚´ê°€ íŒ”ë¡œìš°í•˜ëŠ” ì‚¬ëŒë“¤
  following: many(follows, { relationName: 'user_following' }),
  // ë‚˜ë¥¼ íŒ”ë¡œìš°í•˜ëŠ” ì‚¬ëŒë“¤
  followers: many(follows, { relationName: 'user_followers' }),
}));

export const followsRelations = relations(follows, ({ one }) => ({
  follower: one(users, {
    fields: [follows.followerId],
    references: [users.id],
    relationName: 'user_following',
  }),
  following: one(users, {
    fields: [follows.followingId],
    references: [users.id],
    relationName: 'user_followers',
  }),
}));
```

---

## ğŸš¦ 3. ìì£¼ ê²ªëŠ” ì—ëŸ¬ (Troubleshooting)

### Q. "Relation name collision"?
ê°™ì€ í…Œì´ë¸” ê°„ ê´€ê³„ê°€ 2ê°œ ì´ìƒì´ë©´(ì˜ˆ: ì‘ì„±ì `author`, ìˆ˜ì •ì `editor` ë‘˜ ë‹¤ User ì°¸ì¡°), Drizzleì´ í—·ê°ˆë ¤ í•©ë‹ˆë‹¤.
ğŸ‘‰ **`relationName`** ì˜µì…˜ì„ ì¤˜ì„œ ì´ë¦„ì„ ë¶™ì—¬ì£¼ì„¸ìš”.

```typescript
author: one(users, { ..., relationName: 'author' }),
editor: one(users, { ..., relationName: 'editor' }),
```

### Q. ìˆœí™˜ ì°¸ì¡° (Circular Dependency)
`users.ts`ê°€ `posts.ts`ë¥¼ importí•˜ê³ , `posts.ts`ê°€ `users.ts`ë¥¼ importí•˜ë©´ ì—ëŸ¬ ëœ¹ë‹ˆë‹¤.
ğŸ‘‰ **í•´ê²°ì±…**:
1. ê´€ê³„ ì •ì˜(`relations`)ë§Œ ë”°ë¡œ ëª¨ì•„ì„œ `schema/relations.ts` íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.
2. í˜¹ì€ `relations` ì •ì˜ë¥¼ ê° íŒŒì¼ì˜ ë§¨ ì•„ë˜ë¡œ ë‚´ë¦¬ê³ , í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ê²Œ í•©ë‹ˆë‹¤(Lazy evaluation).

---

## ğŸ”— ë ˆí¼ëŸ°ìŠ¤
- [Relations V2 API](https://orm.drizzle.team/docs/rqb#declaring-relations)
- [Self Referencing Relations](https://orm.drizzle.team/docs/guides/relationships)

**ë‹¤ìŒ ì¥**: [04. ë§ˆì´ê·¸ë ˆì´ì…˜ (Migrations)](./04-migrations.md)
